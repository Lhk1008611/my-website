---
sidebar_position: 4
---

# MySQL 高级第四篇
## 一、数据库的设计规范
> 如果是槽糕的数据库设计可能会造成以下问题: 
>  - `数据冗余`、信息重复、存储空间浪费 
>  - `数据更新、插入.删除的异常` 
>  - 无法正确表示信息
>  - 丢失有效信息 
>  - 程序性能差 

> 良好的数据库设计则有以下优点: 
> - 节省数据的存储空间 
> - 能够保证数据的完整性 
>- 方便进行数据库应用系统的开发

>总之，开始设置数据库的时候，我们就需要重视数据表的设计。为了建立冗余较小、结构合理的数据库，设计数据库时必须遵循一定的规则。

### 1. 范式（Normal Form）
- 第一范式（1st NF）
> `第一范式`主要是确保数据表中`每个字段的值必须具有原子性`，也就是说数据表中`每个字段的值为不可再次拆分的最小数据单元`。

- 第二范式（2nd NF）
> 第二范式要求，在满足第一范式的基础上,还要满足数据表里的每一条数据记录，都是可唯一标识的。`而且所有非主键字段，都必须完全依赖主键，不能只依赖主键的一部分`。如果知道主键的所有属性的值，就可以检索到任何元组(行)的任何属性的任何值。(要求中的主键 ,其实可以拓展替换为候选键)。

  > 第二范式(2NF) 要求`实体的属性完全依赖主关键字`。`如果存在不完全依赖，那么这个属性和主关键字的这一部分应该分离出来形成一 个新的实体， 新实体与元实体之间是一对多的关系。`


- 第三范式（3rd NF）
> 第三范式是在第二范式的基础上,确保数据表中的每一个非主键字段都和主键字段直接相关， 也就是说要求数据表中的所有非主键字段不能依赖于其他非主键字段。(即, `不能存在非主属性A依赖于非主属性B,非主属性 B依赖于主键C的情况，即存在"A→B→C的决定关系`)通俗地讲，该规则的意思是所有非主键属性之间不能有依赖关系，必须相互独立，这里的主键可以拓展为候选键。


- BCBF（巴斯范式）
> - 在3NF的基础上进行改进，提出了`巴斯范式(BCNF)` ,也叫做巴斯-科德范式(Boyce-Codd Normal Form)。BCNF被认为没有新的设计规范加入，只是对第三范式中设计规范要求更强，使得数据库冗余度更小。 所以，`称为是修正的第三范式，或扩充的第三范式`，BCNF不被称为第四范式。
> - 若一个关系达到了第三范式，并且它`只有一个候选键`，或者`它的每个候选键都是单属性`,则该关系自然达到BC范式。 `它在3NF的基础上消除了主属性对候选键的部分依赖或者传递依赖关系`
> - 一般来说，一个数据库设计符合3NF或BCNF就可以了.

- 第四范式
> `多值依赖`的概念: 
> - `多值依赖`即`属性之间的一对多关系`，记为K→→A。 
> - `函数依赖`事实上是`单值依赖`，所以不能表达属性值之间的一对多关系。
> - `平凡的多值依赖`:全集U=K+A,一个K可以对应于多个A，即K→→A。 此时整个表就是一组一对多关系。
> - `非平凡的多值依赖`:全集U=K+A+B,一个K可以对应于多个A,也可以对应于多个B, A与B互相独立，即K→→A，K→→B。`整个表有多组一对多关系`,且有:“一“部分是相同的属性集合，“多“部分是互相独立的属性集合。
>
> 第四范式即在满足巴斯-科德范式(BCNF) 的基础上，`消除非平凡且非函数依赖的多值依赖(即把同一表内的多对多关系删除)`。

-  第五范式、域键范式
> 除了第四范式外，我们还有更高级的第五范式(又称完美范式)和域键范式(DKNF)。 
> - `在满足第四范式(4NF)的基础上，消除不是由候选键所蕴含的连接依赖`。`如果关系模式R中的每一个连接依赖均由R的候选键所隐含，则称此关系模式符合第五范式`。
> - 函数依赖是多值依赖的一种特殊的情况，而多值依赖实际上是连接依赖的一种特殊情况。 但连接依赖不像函数依赖和多值依赖可以由语义点接导出，而是`在关系连接运算时`才反映出来。存在连接依赖的关系模式仍可能遇到数据冗余及插入、修改、删除异常等问题。
> - 第五范式处理的是`无损连接问题`，这个范式基本没有实际意义，因为无损连接很少出现，而且难以察觉。而域键范式试图定义一个终极范式,该范式考虑所有的依赖和约束类型，但是实用价值也是最小的，只存在理论研究中。

- 范式的优缺点
> - `范式的优点`:数据的标准化有助于`消除数据库中的数据冗余`，第三范式(3NF) 通常被认为在性能、扩展性和数据完整性方面达到了最好的平衡。
> - `范式的缺点`:范式的使用，可能`降低查询的效率`。因为范式等级越高，设计出来的数据表就越多、越精细，数据的冗余度就越低，进行数据查询的时候就可能需要关联多张表，这不但代价昂贵，也可能使一些索引策略无效。

> 范式只是提出了设计的标准，实际上设计数据表时，未必一定要符合这些标准。开发中，我们会出现为了性能和读取效率违`反范式化的原则`，通过增加少量的冗余或重复的数据来提高数据库的读性能，减少关联查询，join 表的次数，`实现空间换取时间的目的`。因此在实际的设计过程中要理论结合实际，灵活运用。


### 2. 反范式化
> 反范式可以通过`空间换时间`，提升查询的效率,但是反范式也会带来一些`新问题`: 
> - 存储空间变大了
> - 一个表中字段做了修改，另一个表中冗余的字段也需要做同步修改，否则数据不一致
> - 若采用存储过程来支持数据的更新、删除等额外操作，如果更新频繁，会非常消耗系统资源
> - 在数据量小的情况下，反范式不能体现性能的优势，可能还会让数据库的设计更加复杂


> `当冗余信息有价值或者能大幅度提高查询效率的时候，我们才会采取反范式的优化。`
> - 增加冗余字段的建议：增加冗余字段一定要符合如下两个条件。只有满足这两个条件，才可以考虑增加冗余字段。 
> 1. `这个冗余字段不需要经常进行修收`
> 2. `这个冗余字段查询的时候不可或缺`。


> 反范式优化也常用在`数据仓库的设计`中，因为`数据仓库通常存储历史数据`,对增删改的实时性要求不强，对历史数据的分析需求强。这时适当允许数据的冗余度，更方便进行数据分析。 
> 数据仓库和数据库在使用上的区别: .
> 1. `数据库设计的目的在于捕获数据，而数据仓库设计的目的在于分析数据;`
> 2. 数据库对数据的增删改实时性要求强，需要存储在线的用户数据，而数据仓库存储的一般是历史数据;
> 3. 数据库设计需要尽最避免冗余,但为了提高查询效率也允许一定的冗余度，而`数据仓库在设计上更偏向采用反范式设计`。

### 3.ER模型

> ER模型也叫作`实体关系模型`，是用来描述现实生活中客观存在的事物、事物的属性，以及事物之间关系的一种数据模型。`在开发基于数据库的信息系统的设计阶段，通常使用ER模型来描述信息需求和信息特性，帮助我们理清业务逻辑，从而设计出优秀的数据库。`
ER模型中有三个要素，分别是`实体`、`属性`和`关系`。

> 通过绘制ER模型，我们理清了业务逻辑，把绘制好的ER模型转换成具体的数据表，其转换的原则如下:
> - (1)一个实体通常转换成一一个数据表; 
> - (2) 一个`多对多的关系`，通常也转换成一个数据表;
> - (3)一个1对1，或者1对多的关系，往往通过表的外键来表达，而不是设计一个新的数据表；
> - (4)属性转换成表的字段。

> 可以使用`PowerDesigner工具`绘制数据概念数据模型和物理数据模型，并且还可以进行概念数据模型与物理数据模型的相互转化，还可以将物理数据模型导出为可执行的sql脚本。

### 4. 数据表的设计原则
- “三少一多原则”
>  1. `数据表的个数越少越好` 
>  RDBMS的核心在于对实体和联系的定义，也就是E-R图(Entity Relationship Diagram) , 数据表越少，证明实体和联系设计得越简洁，既方便理解又方便操作。
> 2. `数据表中的字段个数越少越好` 
> 字段个数越多，数据冗余的可能性越大。设置字段个数少的前提是各个字段相互独立,而不是某个字段的取值可以由其他字段计算出来。当然字段个数少是相对的，我们通常会在数据冗余和检索效率中进行平衡。
> 3. `数据表中联合主键的字段个数越少越好`
设置主键是为了确定唯一性，当一个字段无法确定唯一性的时候，就需要采用联合主键的方式(也就是用多个字段来定义一个主键)。联合主键中的字段越多，占用的索引空间越大,不仅会加大理解难度,还会增加运行时间
和索引空间，因此联合主键的字段个数越少越好。
> 4. `使用主键和外键越多越好`
数据库的设计实际上就是定义各种表，以及各种字段之间的关系。这些关系越多，证明这些实体之间的冗余度越低，利用度越高。这样做的好处在于不仅保证了数据表之间的独立性，还能提升相互之间的关联使用率。
> 
> “三少一多"原则的核心就是`简单可复用`。简单指的是用更少的表、更少的字段、更少的联合主键字段来完成数据表的设计。可复用则是通过主键、外键的使用来增强数据表之间的复用率。因为一个主键可以理解是一张表的代表。键设计得越多，证明它们之间的利用率越高。




